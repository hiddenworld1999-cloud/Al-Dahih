<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script>
        if (localStorage.getItem('isLoggedInDaheeh') !== 'true') {
            window.location.href = 'login.html';
        }
        // منع كليك يمين في الصفحة كلها
        document.addEventListener('contextmenu', event => event.preventDefault());
        // منع اختصارات الكيبورد (Print Screen, Save, Copy)
        document.addEventListener('keydown', function(e) {
            if (e.key === 'PrintScreen' || (e.ctrlKey && (e.key === 's' || e.key === 'c' || e.key === 'p'))) {
                alert('عذراً، هذا المحتوى محمي بحقوق الملكية.');
                e.preventDefault();
            }
        });
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تطبيق الدحيح - الرئيسي</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        /* نفس التنسيقات القديمة + تنسيقات الحماية */
        :root { --primary-blue: #0A2647; --accent-orange: #FFC800; --bg-light: #F8F9FA; --text-dark: #212529; --text-grey: #6c757d; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; background-color: var(--bg-light); padding-bottom: 80px; overflow-x: hidden; user-select: none; /* منع تحديد النصوص */ -webkit-user-select: none; }
        
        /* ... باقي التنسيقات الأساسية (الهيدر، البطاقات، الخ) ... */
        .app-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .logo-text { font-size: 1.3rem; font-weight: 700; color: var(--primary-blue); }
        .container { padding: 0 20px; }
        .course-card-vertical { background: white; border-radius: 18px; overflow: hidden; margin-bottom: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: flex; cursor: pointer; }
        .cc-v-content { padding: 15px; flex: 1; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -4px 15px rgba(0,0,0,0.06); z-index: 200; border-top-left-radius: 20px; border-top-right-radius: 20px; }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; color: #adb5bd; flex: 1; }
        .nav-item.active { color: var(--primary-blue); font-weight: 700; }
        .page-section { display: none; }
        .page-section.active { display: block; }
        
        /* === تنسيقات الحماية والعلامة المائية === */
        
        /* مودال عرض الصور */
        .image-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,1); z-index: 500; display: none; justify-content: center; align-items: center; flex-direction: column; overflow: hidden; }
        
        /* حاوية الصورة والعلامة المائية */
        .protected-image-container { position: relative; max-width: 100%; max-height: 80vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        
        /* الصورة نفسها (ممنوع اللمس) */
        .protected-image-container img { 
            max-width: 100%; max-height: 80vh; 
            pointer-events: none; /* يمنع التفاعل مع الصورة نهائياً */
            -webkit-user-drag: none; /* يمنع السحب */
        }

        /* طبقة العلامة المائية */
        .watermark-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* عشان الضغط يعدي من خلالها */
            display: flex; flex-wrap: wrap; align-content: flex-start;
            overflow: hidden; opacity: 0.4; /* شفافية العلامة المائية */
            z-index: 10;
        }

        /* نص العلامة المائية الواحد */
        .watermark-text {
            color: rgba(255, 255, 255, 0.5); /* لون أبيض شفاف */
            font-size: 14px; font-weight: bold;
            transform: rotate(-30deg); /* ميلان النص */
            padding: 40px; /* مسافات بين الاسم والتاني */
            white-space: nowrap;
            text-shadow: 0 0 2px rgba(0,0,0,0.5); /* ظل عشان يبان ع الخلفيات البيضا */
        }

        .close-img-btn { color: white; background: #d32f2f; border: none; padding: 12px 30px; border-radius: 25px; margin-top: 20px; font-weight: bold; cursor: pointer; z-index: 600; }
        
        /* صفحة البروفايل */
        .profile-card { background: white; padding: 30px; border-radius: 20px; text-align: center; margin-top: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <header class="app-header">
        <div class="logo-text">الدحيح</div>
        <span class="material-icons" style="color:var(--primary-blue);" onclick="switchTab('profile', document.querySelectorAll('.nav-item')[3])">account_circle</span>
    </header>

    <div id="page-home" class="page-section active">
        <div class="container" style="margin-top:20px;">
            <h3 style="color:var(--primary-blue); margin-bottom:15px;">المواد الدراسية</h3>
            <div id="coursesListContainer"></div>
        </div>
    </div>

    <div id="page-profile" class="page-section">
        <div class="container">
            <div class="profile-card">
                <span class="material-icons" style="font-size: 60px; color: var(--primary-blue);">account_circle</span>
                <h2 id="profileName" style="margin-top:10px; color:var(--primary-blue)">...</h2>
                <p id="profileCode" style="color:gray;">...</p>
                <button onclick="logout()" style="width:100%; padding:15px; background:#d32f2f; color:white; border:none; border-radius:10px; margin-top:20px;">تسجيل الخروج</button>
            </div>
        </div>
    </div>

    <div id="page-player" class="page-section" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-light); z-index:300; display:none; overflow-y: auto;">
        <div style="padding:15px; background:white; display:flex; align-items:center;">
            <span class="material-icons" style="cursor:pointer; font-size:28px;" onclick="closePlayer()">arrow_forward</span>
            <span style="margin-right:15px; font-weight:bold;">بنك الأسئلة</span>
        </div>
        <div class="container" style="margin-top:20px;">
            <h2 id="playerCourseTitle" style="color:var(--primary-blue)"></h2>
            <div style="margin-top:30px;">
                <button onclick="showProtectedImage('answers')" style="width:100%; padding:20px; background:var(--accent-orange); border:none; border-radius:15px; font-weight:bold; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                    <span>أسئلة بالإجابات</span> <span class="material-icons">fact_check</span>
                </button>
                <button onclick="showProtectedImage('questions')" style="width:100%; padding:20px; background:white; border:2px solid var(--primary-blue); color:var(--primary-blue); border-radius:15px; font-weight:bold; display:flex; justify-content:space-between; align-items:center;">
                    <span>أسئلة بدون إجابات</span> <span class="material-icons">quiz</span>
                </button>
            </div>
        </div>
    </div>

    <div id="imageModal" class="image-modal">
        <div class="protected-image-container">
            <img id="modalImage" src="" alt="محتوى محمي">
            <div id="watermarkOverlay" class="watermark-overlay"></div>
        </div>
        <button class="close-img-btn" onclick="closeImageModal()">إغلاق</button>
    </div>

    <nav class="bottom-nav" id="bottomNav">
        <div class="nav-item active" onclick="switchTab('home', this)"><span class="material-icons">home</span><span>الرئيسية</span></div>
        <div class="nav-item"><span class="material-icons">menu_book</span><span>دوراتي</span></div>
        <div class="nav-item"><span class="material-icons">search</span><span>بحث</span></div>
        <div class="nav-item" onclick="switchTab('profile', this)"><span class="material-icons">person</span><span>حسابي</span></div>
    </nav>

    <script>
        // === بيانات المواد والصور ===
        const coursesData = [
            { id: 1, title: "تصميم البرامج", instructor: "د. تامر", img: "https://placehold.co/100x100", files: { answers: "coding_answers.jpg", questions: "coding_questions.jpg" } },
            { id: 2, title: "الاقتصاد الكلي", instructor: "د. وائل", img: "https://placehold.co/100x100", files: { answers: "macro_answers.jpg", questions: "macro_questions.jpg" } }
            // ضيف باقي المواد هنا
        ];

        let currentCourse = null;
        const studentName = localStorage.getItem('studentName') || "مستخدم"; // اسم الطالب
        const studentCode = localStorage.getItem('studentCode') || "---";

        // تحديث بيانات البروفايل
        document.getElementById('profileName').innerText = studentName;
        document.getElementById('profileCode').innerText = "كود: " + studentCode;

        // عرض المواد
        const container = document.getElementById('coursesListContainer');
        coursesData.forEach(c => {
            container.innerHTML += `
            <div class="course-card-vertical" onclick="openPlayer(${c.id})">
                <div style="width:100px; background:url('${c.img}') center/cover;"></div>
                <div class="cc-v-content">
                    <h4>${c.title}</h4> <p style="color:gray; font-size:0.9rem">${c.instructor}</p>
                </div>
            </div>`;
        });

        function openPlayer(id) {
            currentCourse = coursesData.find(c => c.id === id);
            document.getElementById('playerCourseTitle').innerText = currentCourse.title;
            document.getElementById('page-player').style.display = 'block';
            document.getElementById('bottomNav').style.display = 'none';
        }

        function closePlayer() {
            document.getElementById('page-player').style.display = 'none';
            document.getElementById('bottomNav').style.display = 'flex';
        }

        // === دالة الحماية والعلامة المائية ===
        function showProtectedImage(type) {
            const imageName = currentCourse.files[type];
            const modal = document.getElementById('imageModal');
            const img = document.getElementById('modalImage');
            const watermarkContainer = document.getElementById('watermarkOverlay');

            img.src = imageName;
            
            // توليد العلامة المائية (تكرار الاسم 100 مرة)
            watermarkContainer.innerHTML = ''; // مسح القديم
            
            // النص اللي هيظهر: الاسم + الكود + رقم الموبايل (لو متاح)
            // هنكرره كتير عشان يملى الشاشة
            const repeatCount = 100; 
            const watermarkText = `${studentName} - ${studentCode}`;

            for (let i = 0; i < repeatCount; i++) {
                const span = document.createElement('div');
                span.className = 'watermark-text';
                span.innerText = watermarkText;
                watermarkContainer.appendChild(span);
            }

            modal.style.display = 'flex';
        }

        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        function switchTab(tabName, element) {
            document.querySelectorAll('.page-section').forEach(p => { 
                if(p.id !== 'page-player') p.classList.remove('active'); 
            });
            document.getElementById('page-' + tabName).classList.add('active');
            if(element) {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                element.classList.add('active');
            }
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>